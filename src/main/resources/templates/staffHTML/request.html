<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <link rel="stylesheet" href="/css/staffCSS/request.css"/>
    <title th:text="${title}"></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <header th:insert="blocksHTML/headerStaff :: headerStaff"></header>
</head>
<body>

<section class="sectionRequest">
    <section class="newRequest2">
        <h1>Написать заявку</h1>

        <form  th:action="@{/staff-request}"
               method="post" class="form">
            <div class="allDivRequest">

                <div class="DivRequest" >
                    <input class="inn"  onkeypress='validator(event)' id="room" type="text"  name="room" maxlength="10"   placeholder="№ кабинета*">
                </div>

                <div class="DivRequest">
                    <input type="hidden" class="inn" onkeyup="checkParams()"  id="level" name="level" placeholder="Уровень заявки*"/>
                    <select class="inn" required
                            onchange="document.getElementById('level').value=this.value;">
                        <option value="" disabled selected hidden>Уровень заявки*</option>
                        <option value="Срочный">Срочный</option>
                        <option value="В течении дня">В течении дня</option>
                    </select>
                </div>


                <div class="DivRequest">
                    <input list="characterFromWhom" class="inn" th:value="${#authentication.name}" onkeyup="checkParams()" id="fromWhom" name="fromWhom" placeholder="Заявитель*">
                    <datalist id="characterFromWhom" >
                        <option th:each="position : ${positions}"
                                th:value="${position}"
                                th:text="${position}">
                        </option>
                    </datalist>
                </div>

                <div class="DivRequest">
                    <input list="character" class="inn"  onkeyup="checkParams()" id="toWhom" name="toWhom" placeholder="Исполнитель*">
                    <datalist id="character" >
                        <option th:each="position : ${positions}"
                                th:value="${position}"
                                th:text="${position}">
                        </option>
                    </datalist>
                </div>



                <div class="DivRequest">
                    <textarea onkeyup="checkParams()" id="text" class="size" name="text"
                              placeholder="Опишите пробелему*"></textarea>
                </div>
                <div class="DivRequest">
                    <Button class="btnAddRequest" id="submit" type="submit" disabled="disabled" >Отправить заявку</Button>
                </div>
            </div>
        </form>
    </section>
</section>


<section class="sectionRequest">
    <div class="newRequest1">
        <h1>Список заявок</h1>
        <div class="DivRequest">
            <form method="post" th:action="staff-filter-request">
                <input type="hidden" id="statusFilter"  name="filter" placeholder="Поиск по статусу заявки" />
                <input type="hidden" th:value="${#authentication.name}"  id="toWhomFilter" name="toWhom" placeholder="toWhom" />
                <select class="inn"
                        onchange="document.getElementById('statusFilter').value=this.value;">
                    <option value="" disabled selected hidden>Статус заявки</option>
                    <option value="Выполнено">Выполнено</option>
                    <option value="На выполнении">На выполнении</option>
                    <option value="Не выполнено">Не выполнено</option>
                </select>
                <div class="DivRequest1">
                    <button class="btnSearchFilter" id="submitFilter"  type="submit">Найти</button>

                </div>
            </form>
        </div>

<!--        <div th:each="el : ${requests}" class="request">-->
            <div th:if="${#authentication.name == el.toWhom}" th:each="el : ${requests}"  class="request">

            <h4>Заказчик:</h4>
            <div class="allDiv">
                <div class="c1">
                    <div class="staffReq">Дата подачи заявки</div>
                    <div class="staffReq">Уровень</div>
                    <div class="staffReq">№ кабинета</div>
                    <div class="staffReq">Заказчик</div>
                </div>
                <div class="c1">
                    <div th:text="${el.createDate}" class="staffReq"><input type="text" id="createDate" name="createDate"></div>
                    <div th:text="${el.level}" class="staffReq"><input type="text" id="Rlevel" name="level"></div>
                    <div th:text="${el.room}" class="staffReq"><input type="text" id="Rroom" name="room"></div>
                    <div th:text="${el.fromWhom}" class="staffReq"><input type="text" id="RfromWhom" name="fromWhom">
                    </div>
                </div>
                <h4>Именование заявки:</h4>
                <div class="c2">
                    <div th:text="${el.text}" class="wrap2"><textarea type="text" id="Rtext" name="text"></textarea>
                    </div>
                </div>
                <h4>Исполнитель:</h4>
                <div class="c3">
                    <div class="staffReq">Исполнитель</div>
                    <div class="staffReq">Статус</div>
                    <div class="staffReq">ФИО</div>
                    <div class="staffReq">Дата выполнения</div>
                </div>

                <div class="c3">
                    <div th:text="${el.toWhom}" class="staffReq"><input type="text" id="RtoWhom" name="toWhom"></div>
                    <div th:text="${el.status}" class="staffReq"><input type="text" id="status" name="status"></div>
                    <div th:text="${el.name}" class="staffReq"><input type="text" id="name" name="name"></div>
                    <div th:text="${el.endDate}" class="staffReq"><input type="text" id="endDate" name="endDate"></div>
                </div>

                <h4>Комментарий:</h4>
                <div class="c2">
                    <div th:text="${el.comment}" class="wrap2"><textarea type="text" id="Ctext" name="comment"></textarea>
                    </div>
                </div>

                    <div class="btnEdit"><a th:href="'/staff-request/' + ${el.id} + '/edit'">Ответить на заявку</a></div>

            </div>
        </div>
    </div>
</section>

<div class="footer">
    <p> &copy; "Предприятие "АБЦ" 2021.</p>
</div>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="/js/request.js"></script>

</body>
</html>